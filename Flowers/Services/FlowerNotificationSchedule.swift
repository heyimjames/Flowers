import Foundation

/// FlowerNotificationSchedule provides pre-chosen notification times for each day of the year
/// All times are in Lisbon timezone (Europe/Lisbon) to ensure global synchronization
/// Every user worldwide receives their flower at the same moment
struct FlowerNotificationSchedule {
    // Lisbon timezone - all times are relative to this timezone
    static let timezone = TimeZone(identifier: "Europe/Lisbon")!
    
    // Pre-chosen times for each day of the year (hour, minute)
    // Special times:
    // - January 1st is at 00:00 (midnight) for New Year's celebration
    // - All other days are between 8:00 and 23:30 Lisbon time
    // - Times are spread throughout the day to create variety
    // - Some holidays have evening times (e.g., Valentine's Day at 20:45)
    static let dailyTimes: [(month: Int, day: Int, hour: Int, minute: Int)] = [
        // January
        (1, 1, 0, 0),     // New Year - Midnight
        (1, 2, 9, 15),
        (1, 3, 14, 45),
        (1, 4, 11, 30),
        (1, 5, 16, 20),
        (1, 6, 10, 10),
        (1, 7, 18, 35),
        (1, 8, 8, 45),
        (1, 9, 21, 15),
        (1, 10, 13, 20),
        (1, 11, 17, 40),
        (1, 12, 9, 50),
        (1, 13, 20, 30),
        (1, 14, 12, 15),
        (1, 15, 15, 55),
        (1, 16, 11, 5),
        (1, 17, 19, 25),
        (1, 18, 8, 30),
        (1, 19, 22, 10),
        (1, 20, 14, 0),
        (1, 21, 16, 45),
        (1, 22, 10, 35),
        (1, 23, 21, 50),
        (1, 24, 13, 40),
        (1, 25, 17, 20),
        (1, 26, 9, 25),
        (1, 27, 20, 5),
        (1, 28, 12, 55),
        (1, 29, 15, 30),
        (1, 30, 11, 45),
        (1, 31, 18, 15),
        
        // February
        (2, 1, 8, 20),
        (2, 2, 22, 25),
        (2, 3, 14, 35),
        (2, 4, 16, 10),
        (2, 5, 10, 50),
        (2, 6, 19, 40),
        (2, 7, 13, 5),
        (2, 8, 21, 30),
        (2, 9, 9, 0),
        (2, 10, 17, 55),
        (2, 11, 12, 25),
        (2, 12, 15, 15),
        (2, 13, 11, 20),
        (2, 14, 20, 45),   // Valentine's Day - Evening
        (2, 15, 8, 55),
        (2, 16, 18, 50),
        (2, 17, 14, 20),
        (2, 18, 16, 35),
        (2, 19, 10, 15),
        (2, 20, 22, 0),
        (2, 21, 13, 45),
        (2, 22, 17, 30),
        (2, 23, 9, 35),
        (2, 24, 19, 10),
        (2, 25, 12, 40),
        (2, 26, 21, 5),
        (2, 27, 15, 50),
        (2, 28, 11, 55),
        (2, 29, 18, 25),   // Leap year
        
        // March
        (3, 1, 8, 10),
        (3, 2, 20, 20),
        (3, 3, 14, 50),
        (3, 4, 16, 25),
        (3, 5, 10, 40),
        (3, 6, 23, 15),
        (3, 7, 13, 30),
        (3, 8, 17, 15),    // International Women's Day
        (3, 9, 9, 20),
        (3, 10, 19, 55),
        (3, 11, 12, 10),
        (3, 12, 15, 40),
        (3, 13, 11, 35),
        (3, 14, 21, 20),
        (3, 15, 8, 40),
        (3, 16, 18, 5),
        (3, 17, 14, 15),   // St. Patrick's Day
        (3, 18, 16, 50),
        (3, 19, 10, 25),
        (3, 20, 22, 35),
        (3, 21, 13, 15),
        (3, 22, 17, 45),
        (3, 23, 9, 10),
        (3, 24, 20, 40),
        (3, 25, 12, 30),
        (3, 26, 19, 20),
        (3, 27, 15, 25),
        (3, 28, 11, 10),
        (3, 29, 21, 55),
        (3, 30, 8, 25),
        (3, 31, 18, 40),
        
        // April
        (4, 1, 14, 5),
        (4, 2, 16, 15),
        (4, 3, 10, 55),
        (4, 4, 20, 10),
        (4, 5, 13, 55),
        (4, 6, 22, 20),
        (4, 7, 9, 45),
        (4, 8, 17, 25),
        (4, 9, 12, 0),
        (4, 10, 15, 5),
        (4, 11, 11, 50),
        (4, 12, 19, 35),
        (4, 13, 8, 50),
        (4, 14, 21, 40),
        (4, 15, 14, 30),
        (4, 16, 16, 40),
        (4, 17, 10, 20),
        (4, 18, 23, 5),
        (4, 19, 13, 25),
        (4, 20, 18, 55),
        (4, 21, 9, 30),
        (4, 22, 20, 25),
        (4, 23, 12, 45),
        (4, 24, 17, 10),
        (4, 25, 15, 20),
        (4, 26, 11, 15),
        (4, 27, 22, 50),
        (4, 28, 8, 15),
        (4, 29, 19, 45),
        (4, 30, 14, 40),
        
        // May
        (5, 1, 16, 30),    // May Day
        (5, 2, 10, 5),
        (5, 3, 21, 15),
        (5, 4, 13, 40),
        (5, 5, 18, 20),
        (5, 6, 9, 55),
        (5, 7, 20, 50),
        (5, 8, 12, 20),
        (5, 9, 17, 35),
        (5, 10, 15, 45),
        (5, 11, 11, 25),
        (5, 12, 19, 0),
        (5, 13, 8, 35),
        (5, 14, 22, 15),
        (5, 15, 14, 25),
        (5, 16, 16, 55),
        (5, 17, 10, 30),
        (5, 18, 23, 20),
        (5, 19, 13, 10),
        (5, 20, 18, 45),
        (5, 21, 9, 40),
        (5, 22, 21, 25),
        (5, 23, 12, 35),
        (5, 24, 17, 50),
        (5, 25, 15, 10),
        (5, 26, 11, 40),
        (5, 27, 20, 15),
        (5, 28, 8, 5),
        (5, 29, 19, 30),
        (5, 30, 14, 55),
        (5, 31, 22, 40),
        
        // June
        (6, 1, 10, 45),
        (6, 2, 16, 20),
        (6, 3, 13, 50),
        (6, 4, 21, 35),
        (6, 5, 9, 15),
        (6, 6, 18, 10),
        (6, 7, 12, 50),
        (6, 8, 20, 30),
        (6, 9, 15, 35),
        (6, 10, 11, 0),
        (6, 11, 17, 20),
        (6, 12, 8, 45),
        (6, 13, 23, 10),
        (6, 14, 14, 10),
        (6, 15, 19, 15),
        (6, 16, 10, 10),
        (6, 17, 22, 5),
        (6, 18, 13, 35),
        (6, 19, 16, 45),
        (6, 20, 9, 25),
        (6, 21, 20, 55),   // Summer Solstice
        (6, 22, 12, 15),
        (6, 23, 18, 30),
        (6, 24, 15, 0),
        (6, 25, 11, 20),
        (6, 26, 21, 45),
        (6, 27, 8, 30),
        (6, 28, 17, 55),
        (6, 29, 14, 35),
        (6, 30, 19, 40),
        
        // July
        (7, 1, 10, 25),
        (7, 2, 22, 30),
        (7, 3, 13, 20),
        (7, 4, 16, 10),    // Independence Day (US)
        (7, 5, 9, 50),
        (7, 6, 21, 10),
        (7, 7, 12, 40),
        (7, 8, 18, 25),
        (7, 9, 15, 15),
        (7, 10, 11, 45),
        (7, 11, 20, 20),
        (7, 12, 8, 20),
        (7, 13, 17, 40),
        (7, 14, 14, 20),   // Bastille Day
        (7, 15, 23, 25),
        (7, 16, 10, 35),
        (7, 17, 19, 5),
        (7, 18, 13, 45),
        (7, 19, 16, 35),
        (7, 20, 9, 5),
        (7, 21, 22, 45),
        (7, 22, 12, 5),
        (7, 23, 18, 50),
        (7, 24, 15, 40),
        (7, 25, 11, 10),
        (7, 26, 21, 30),
        (7, 27, 8, 55),
        (7, 28, 20, 0),
        (7, 29, 14, 45),
        (7, 30, 17, 15),
        (7, 31, 10, 50),
        
        // August
        (8, 1, 19, 25),
        (8, 2, 13, 5),
        (8, 3, 23, 0),
        (8, 4, 16, 50),
        (8, 5, 9, 30),
        (8, 6, 21, 55),
        (8, 7, 12, 25),
        (8, 8, 18, 15),
        (8, 9, 15, 25),
        (8, 10, 11, 30),
        (8, 11, 20, 35),
        (8, 12, 8, 10),
        (8, 13, 17, 5),
        (8, 14, 14, 30),
        (8, 15, 22, 20),
        (8, 16, 10, 15),
        (8, 17, 19, 50),
        (8, 18, 13, 30),
        (8, 19, 16, 0),
        (8, 20, 9, 20),
        (8, 21, 21, 40),
        (8, 22, 12, 55),
        (8, 23, 18, 40),
        (8, 24, 15, 50),
        (8, 25, 11, 55),
        (8, 26, 20, 10),
        (8, 27, 8, 40),
        (8, 28, 23, 15),
        (8, 29, 14, 15),
        (8, 30, 17, 30),
        (8, 31, 10, 40),
        
        // September
        (9, 1, 19, 10),
        (9, 2, 13, 15),
        (9, 3, 22, 35),
        (9, 4, 16, 25),
        (9, 5, 9, 55),
        (9, 6, 21, 20),
        (9, 7, 12, 10),
        (9, 8, 18, 55),
        (9, 9, 15, 5),
        (9, 10, 11, 15),
        (9, 11, 20, 45),
        (9, 12, 8, 25),
        (9, 13, 17, 50),
        (9, 14, 14, 40),
        (9, 15, 23, 5),
        (9, 16, 10, 55),
        (9, 17, 19, 35),
        (9, 18, 13, 40),
        (9, 19, 16, 15),
        (9, 20, 9, 10),
        (9, 21, 22, 0),
        (9, 22, 12, 30),   // Autumn Equinox
        (9, 23, 18, 20),
        (9, 24, 15, 30),
        (9, 25, 11, 40),
        (9, 26, 20, 25),
        (9, 27, 8, 50),
        (9, 28, 21, 15),
        (9, 29, 14, 5),
        (9, 30, 17, 25),
        
        // October
        (10, 1, 10, 20),
        (10, 2, 19, 55),
        (10, 3, 13, 25),
        (10, 4, 22, 10),
        (10, 5, 16, 40),
        (10, 6, 9, 40),
        (10, 7, 21, 50),
        (10, 8, 12, 45),
        (10, 9, 18, 35),
        (10, 10, 15, 20),
        (10, 11, 11, 5),
        (10, 12, 20, 0),
        (10, 13, 8, 15),
        (10, 14, 17, 35),
        (10, 15, 14, 50),
        (10, 16, 23, 20),
        (10, 17, 10, 30),
        (10, 18, 19, 20),
        (10, 19, 13, 55),
        (10, 20, 16, 5),
        (10, 21, 9, 25),
        (10, 22, 22, 25),
        (10, 23, 12, 20),
        (10, 24, 18, 10),
        (10, 25, 15, 45),
        (10, 26, 11, 25),
        (10, 27, 20, 30),
        (10, 28, 8, 35),
        (10, 29, 21, 5),
        (10, 30, 14, 25),
        (10, 31, 20, 0),   // Halloween
        
        // November
        (11, 1, 10, 10),
        (11, 2, 19, 45),
        (11, 3, 13, 10),
        (11, 4, 22, 40),
        (11, 5, 16, 30),
        (11, 6, 9, 15),
        (11, 7, 21, 35),
        (11, 8, 12, 0),
        (11, 9, 18, 25),
        (11, 10, 15, 55),
        (11, 11, 11, 50),  // Veterans Day
        (11, 12, 20, 15),
        (11, 13, 8, 5),
        (11, 14, 17, 45),
        (11, 15, 14, 35),
        (11, 16, 23, 10),
        (11, 17, 10, 45),
        (11, 18, 19, 30),
        (11, 19, 13, 20),
        (11, 20, 16, 20),
        (11, 21, 9, 35),
        (11, 22, 22, 15),
        (11, 23, 12, 35),
        (11, 24, 18, 45),
        (11, 25, 15, 10),  // Day after Thanksgiving (US)
        (11, 26, 11, 35),
        (11, 27, 20, 40),
        (11, 28, 8, 45),
        (11, 29, 21, 25),
        (11, 30, 14, 0),
        
        // December
        (12, 1, 17, 10),
        (12, 2, 10, 0),
        (12, 3, 19, 15),
        (12, 4, 13, 45),
        (12, 5, 22, 55),
        (12, 6, 16, 45),
        (12, 7, 9, 0),
        (12, 8, 21, 10),
        (12, 9, 12, 15),
        (12, 10, 18, 0),
        (12, 11, 15, 35),
        (12, 12, 11, 20),
        (12, 13, 20, 50),
        (12, 14, 8, 30),
        (12, 15, 17, 20),
        (12, 16, 14, 10),
        (12, 17, 23, 25),
        (12, 18, 10, 15),
        (12, 19, 19, 40),
        (12, 20, 13, 30),
        (12, 21, 16, 55),  // Winter Solstice
        (12, 22, 9, 45),
        (12, 23, 22, 5),
        (12, 24, 18, 30),  // Christmas Eve
        (12, 25, 12, 0),   // Christmas Day
        (12, 26, 15, 25),
        (12, 27, 11, 45),
        (12, 28, 21, 0),
        (12, 29, 8, 20),
        (12, 30, 20, 30),
        (12, 31, 19, 0)    // New Year's Eve
    ]
    
    // Get the scheduled time for a specific date
    static func getScheduledTime(for date: Date) -> Date? {
        let calendar = Calendar.current
        let components = calendar.dateComponents([.month, .day], from: date)
        
        guard let month = components.month, let day = components.day else { return nil }
        
        // Find the time for this day
        guard let timeEntry = dailyTimes.first(where: { $0.month == month && $0.day == day }) else {
            return nil
        }
        
        // Create a date with the scheduled time in Lisbon timezone
        var dateComponents = calendar.dateComponents([.year, .month, .day], from: date)
        dateComponents.hour = timeEntry.hour
        dateComponents.minute = timeEntry.minute
        dateComponents.timeZone = timezone
        
        return calendar.date(from: dateComponents)
    }
    
    // Get the next scheduled flower time from now
    static func getNextScheduledTime(from date: Date = Date()) -> Date? {
        let calendar = Calendar.current
        
        // First check if there's a scheduled time today that hasn't passed
        if let todayTime = getScheduledTime(for: date), todayTime > date {
            return todayTime
        }
        
        // Otherwise look for the next day with a scheduled time
        for daysAhead in 1...366 {
            guard let futureDate = calendar.date(byAdding: .day, value: daysAhead, to: date) else { continue }
            if let scheduledTime = getScheduledTime(for: futureDate) {
                return scheduledTime
            }
        }
        
        return nil
    }
} 